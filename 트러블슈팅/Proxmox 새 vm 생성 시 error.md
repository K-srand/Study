TASK ERROR: KVM virtualisation configured, but not available. Either disable in VM configuration or enable in BIOS.

해당 vm 선택 후 옵션에서 kvm 하드웨어 가상화를 no로 변경해주면 해결됩니다.

pfSense를 Proxmox에서 가상 머신(VM)으로 실행할 때 **KVM 하드웨어 가상화(KVM hardware virtualization)**를 해제해야 하는 이유는 특정 네트워크 드라이버와 가상화 기술의 상호작용 문제 때문일 가능성이 큽니다. 이를 자세히 살펴보면 다음과 같습니다:

---

### **1. pfSense의 FreeBSD 기반과 KVM의 호환성 문제**

- pfSense는 FreeBSD 기반의 운영 체제입니다. 과거에는 FreeBSD가 KVM 하드웨어 가상화 기술과 완전히 호환되지 않거나, 특정 네트워크 드라이버 및 기능에서 충돌이 발생하곤 했습니다.
- **문제점**: KVM이 활성화된 상태에서 pfSense가 네트워크 인터페이스를 제대로 인식하지 못하거나 성능 저하, 드라이버 오류 등이 발생할 수 있습니다.
- **해결 방법**: 하드웨어 가상화를 비활성화하여 안정성을 확보.

---

### **2. 네트워크 인터페이스 카드(NIC) 에뮬레이션**

- pfSense는 네트워크 인터페이스와 관련하여 고성능 및 안정성을 요구합니다.
- KVM 하드웨어 가상화를 활성화하면 **VirtIO** 드라이버를 사용하는데, FreeBSD 기반의 pfSense는 VirtIO 드라이버에 대해 한동안 최적화가 부족한 상태였습니다.
    - 이로 인해 패킷 손실, 네트워크 성능 저하 등이 발생 가능.
- **해결 방법**: KVM 하드웨어 가상화를 비활성화하면 Proxmox는 네트워크 인터페이스를 e1000 또는 Intel emulated NIC으로 설정하게 되어 호환성이 향상됩니다.

---

### **3. Nested Virtualization 사용**

- pfSense VM 내부에서 추가적인 가상화 계층(예: pfSense 내부에서 Docker나 기타 VM을 실행)을 설정하려는 경우, KVM 하드웨어 가상화를 비활성화해야만 안정적으로 동작할 수 있습니다.
- 이는 pfSense가 중첩 가상화 환경을 제대로 지원하지 않기 때문입니다.

---

### **4. 디버깅 및 호환성 테스트**

- pfSense를 디버깅하거나 특정 네트워크 설정을 테스트할 때, KVM 하드웨어 가상화를 비활성화하여 하드웨어 의존성을 제거하는 경우가 있습니다.
- 특히, 네트워크 트래픽 처리를 소프트웨어 방식으로 처리하여 환경의 문제점을 더 명확히 분석할 수 있습니다.

---

### **5. 특정 Hypervisor 설정 요구사항**

- Proxmox나 VMware 같은 하이퍼바이저에서 pfSense VM에 대해 KVM을 비활성화하도록 권장할 때는, 하드웨어 가속 기능이 pfSense의 네트워크 및 시스템 안정성을 저해할 가능성을 염두에 둔 것입니다.
- 예를 들어:
    - CPU 에뮬레이션에서 비정상적인 동작.
    - 특정 BIOS/UEFI와의 충돌.

---

### **KVM 하드웨어 가상화 해제의 영향**

- **장점**:
    - pfSense가 네트워크 및 디스크 I/O 관련 드라이버에서 더 안정적으로 동작.
    - 설정 및 디버깅 과정에서 예상치 못한 하드웨어 가상화 문제를 피할 수 있음.
- **단점**:
    - VM 성능 저하 (특히 고부하 환경에서 CPU 사용률이 높아질 수 있음).
    - 하드웨어 가속이 필요한 기능을 사용할 수 없음.